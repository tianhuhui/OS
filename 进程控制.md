## 进程控制

进程控制操作完成进程各状态之间的转换，由具有特定功能的**原语**完成
- 进程创建原语
- 进程撤销原语
- 阻塞原语
- 唤醒原语
- 挂起原语
- 激活原语
- 改变进程优先级
- ……

> **原语（primitive）**
> 完成某种特定功能的一段程序，具有不可分割性或不可中断性
> 即原语的执行必须是连续的，在执行过程中不允许被中断
> 
> **原子操作（atomic）**

### 1 进程创建
- 给新进程分配一个唯一标识以及进程控制块
- 为进程分配地址空间
- 初始化进程控制块
	- 设置默认值（如：状态为New，...）
- 设置相应的队列指针
如：把新进程加到就绪队列链表中

- UNIX：fork/exec
- Windows：CreateProcess

### 2 进程的撤销
结束进程
- 收回进程所占有的资源
	- 关闭打开的文件、断开网络连接、回收分配的内存、……
- 撤销该进程的PCB
- UNIX：exit
- Windows：TerminateProcess

### 3 进程阻塞
处于运行状态的进程，在其运行过程中期待某一事件发生，如**等待键盘输入、等待磁盘数据传输完成、等待其他进程发送消息**，当被等待的事件未发生时，由进程自己执行**阻塞原语**，使自己由运行态变为阻塞态
- UNIX：wait
- Windows：WaitForSingleObject

### 4 UNIX的几个进程控制操作
- **fork()**  通过复制调用进程来建立新的进程，是最基本的进程建立过程
- **exec()**  包括一系列系统调用，它们都是通过用一段新的程序代码覆盖原来的地址空间，实现进程执行代码的转换
- **wait()**  提供初级进程同步操作，能使一个进程等待另外一个进程的结束
- **exit()**  用来终止一个进程的运行

以上都是**系统调用**

---

## 深入理解进程概念
### 进程的分类
- 1
	- 系统进程
	- 用户进程


- 2
	- 前台进程
	- 后台进程


- 3
	- CPU密集型进程
	- I/O密集型进程

### 进程层次结构
- UNIX进程家族树：init为根
- Windows：地位相同

### 进程地址空间

### 进程映像（IMAGE）
**对进程执行活动全过程的静态描述**
由进程地址空间内容、硬件寄存器内容及该进程相关的内核数据结构、内核栈组成
- 用户相关：进程地址空间（包括代码段、数据段、堆和栈、共享库……）
- 寄存器相关：程序计数器、指令寄存器、程序状态寄存器、栈指针、通用寄存器等的值
- 内核相关
	- 静态部分：PCB及各种资源数据结构
	- 动态部分：内核栈（不同进程在进入内核后使用不同的内核栈）

### 上下文（CONTEXT）切换
- 将CPU硬件状态从一个进程换到另一个进程的过程称为**上下文切换**
- 进程运行时，其硬件状态保持在CPU上的寄存器中
寄存器：程序计数器、程序状态寄存器、栈指针、通用寄存器、其他控制寄存器的值
- 进程不运行时，这些寄存器的值保存在进程控制块PCB中；当操作系统要运行一个新的进程时，将PCB中的相关值送到对应的寄存器中

